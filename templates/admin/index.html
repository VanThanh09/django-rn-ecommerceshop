{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static "admin/css/dashboard.css" %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
    .container {
        min-height: 78vh;
        display: flex;
        flex-direction: column;
    }
    .header-content {
        display: flex;
        gap: 25px;
        padding: 20px;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .header-content-card {
        flex: 1;
        min-width: 220px;
        min-height: 80px;
        background: #fff;
        border-radius: 10px;
        color: black;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
        border: 2px solid white;
    }
    .header-content-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        cursor: pointer;
    }
    .main-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin: 0px 20px;
    }
    .sup-content {
        display: flex;
        flex: 1;
        gap: 20px;
    }
    .chart {
        flex: 1;
        max-height: 400px;
        border-radius: 10px;
        padding: 10px;
    }
    .chart canvas {
        width: 100% !important; /* Ép canvas co giãn theo container */
        display: block;
    }
    .custom-below-sidebar {
        padding: 10px;
        background: #fff3cd;
        border-top: 1px solid #ccc;
        margin: 10px;
    }
    .header-content-card .icon {
        font-size: 32px;
    }
    .header-content-card .info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin-top: 8px;
    }
    .header-content-card .info .title {
        font-size: 15px;
        opacity: 0.8;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0px;
    }
    .header-content-card .info .value {
        font-size: 15px;
        font-weight: 500;
        font-family: 'Roboto Mono', 'Fira Code', 'SF Mono', monospace;
        margin: 0px;
    }
    .user-card {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    .store-card {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    .order-card {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    .revenue-card {
        background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);
    }
    .header-content a {
        color: inherit;        /* Kế thừa màu chữ từ phần tử cha */
        text-decoration: none; /* Bỏ gạch chân */
        background: none;      /* Bỏ nền nếu có */
        transition: none;      /* Bỏ hiệu ứng chuyển đổi (nếu có) */
        outline: none;         /* Bỏ viền khi focus */
    }
    .header-content a:active,
    .header-content a:visited,
    .header-content a:focus {
        color: inherit;
        text-decoration: none;
        outline: none;
    }
</style>
{% endblock %}

{% block content_title %}
    <div style="display: flex; align-items: center; gap: 20px; padding: 5px 13px;">
        <div>
            <h1 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 700; font-size: 20px; margin: 0;">
                Xin chào, {% firstof user.get_short_name user.get_username %}
            </h1>
            {% load tz %}
            <p>Lần đăng nhập trước: {% timezone "Asia/Ho_Chi_Minh" %}{{ user.last_login }}{% endtimezone %}</p>
        </div>
    </div>
{% endblock %}

{% block nav-sidebar %}
    {{ block.super }}
{% endblock %}

{% block content %}
<div class="container">
    <div class="header-content">
        <div class="header-content-card user-card">
            <a href="" style="padding: 20px;" title="Tới trang người dùng">
                <div class="icon"><i class="fa-regular fa-circle-user" style="color: #3c50e1;"></i></div>
                <div class="info">
                    <p class="title">Tổng người dùng</p>
                    <p class="value">{{ total_users }}</p>
                </div>
                <div class="info">
                    <p class="title">Số cửa hàng</p>
                    <p class="value">{{ total_stores }}</p>
                </div>
            </a>
        </div>

        <div class="header-content-card store-card">
            <a href="" style="padding: 20px;" title="Tới trang cửa hàng">
                <div class="icon">&#128722;</div>
                <div class="info">
                    <p class="title">Số sản phẩm</p>
                    <p class="value">{{ total_products }}</p>
                </div>
                <div class="info">
                    <p class="title">Đã bán</p>
                    <p class="value"></p>
                </div>
                <div class="info">
                    <p class="title">Bán trong 30 ngày</p>
                    <p class="value"></p>
                </div>
            </a>
        </div>


        <div class="header-content-card order-card" title="Tới trang đơn hàng">
            <a href="" style="padding: 20px;">
                <div class="icon">&#128230;</div>
                <div class="info">
                    <p class="title">Tổng đơn hàng</p>
                    <p class="value">{{total_order}}</p>
                </div>
                <div class="info">
                    <p class="title">30 ngày gần đây</p>
                    <p class="value">{{total_order_30_days}}</p>
                </div>
            </a>
        </div>

        <div class="header-content-card revenue-card" title="Tới trang cửa hàng">
            <a href="" style="padding: 20px;">
                <div class="icon">&#128181;</div>
                <div class="info">
                    <p class="title">Doanh thu</p>
                    <p class="value">₫</p>
                </div>
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <div class="main-content">
        <div class="sup-content">
            <div class="chart">
                <canvas id="userChart"></canvas>

                <script>
                    const labels = {{ user_chart_labels|safe }};
                    const data = {{ user_chart_data|safe }};

                    const ctx = document.getElementById('userChart');

                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: "Lượt đăng ký mới theo tháng",
                                data: data,
                                fill: true,
                                borderColor: 'rgba(0, 191, 255, 1)',
                                backgroundColor: 'rgba(0, 191, 255, 0.2)',
                                tension: 0.3,
                                pointBackgroundColor: 'rgba(0, 191, 255, 1)',
                                pointBorderColor: '#fff',
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1,
                                    },
                                }
                            }
                        }
                    });
                </script>
            </div>

            <div class="chart">

            </div>
        </div>

        <div class="sup-content">
            <div class="chart">

            </div>

            <div class="chart">

            </div>
        </div>
    </div>

</div>

{% endblock %}
